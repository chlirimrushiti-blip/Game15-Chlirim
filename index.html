<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8" />
  <title>Mini Giochi Bambini</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- PWA -->
  <link rel="manifest" href="manifest.json">
  <link rel="icon" type="image/png" sizes="192x192" href="icons/icon-192.png">
  <link rel="apple-touch-icon" href="icons/icon-192.png">
  <meta name="theme-color" content="#ff7eb3">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <meta name="apple-mobile-web-app-title" content="Mini Giochi">
  <meta name="mobile-web-app-capable" content="yes">

  <style>
    * {
      box-sizing: border-box;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    }

    html, body {
      margin: 0;
      padding: 0;
      width: 100%;
      height: 100%;
      background: #000;
    }

    body {
      overflow: hidden;
    }

    #app {
      width: 100vw;
      height: 100vh;
      margin: 0;
      background: radial-gradient(circle at top, #ffffff, #e0f2ff);
      position: relative;
      overflow: hidden;
    }

    .screen {
      position: absolute;
      inset: 0;
      display: none;
      flex-direction: column;
      background: radial-gradient(circle at top, #ffffff, #e0f2ff);
    }

    .screen.active {
      display: flex;
    }

    .menu-header, .game-header {
      flex: 0 0 auto;
      padding: 8px 12px;
      display: flex;
      align-items: center;
      gap: 10px;
      background: linear-gradient(135deg, #ffe4f2, #e0f3ff);
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      z-index: 5;
    }

    .menu-header {
      justify-content: center;
      flex-direction: column;
      text-align: center;
    }

    .menu-header h1 {
      margin: 0;
      font-size: 1.8rem;
      color: #513b96;
    }

    .menu-header p {
      margin: 4px 0 0;
      font-size: 0.95rem;
      color: #7b5ba8;
    }

    .back-btn {
      border: none;
      border-radius: 999px;
      padding: 8px 16px;
      font-size: 0.9rem;
      cursor: pointer;
      background: linear-gradient(135deg, #805ad5, #d53f8c);
      color: #fff;
      box-shadow: 0 3px 6px rgba(0,0,0,0.25);
      white-space: nowrap;
    }

    .game-title {
      font-size: 1.2rem;
      font-weight: 700;
      color: #4a3c89;
    }

    .screen-body {
      flex: 1 1 auto;
      display: flex;
      flex-direction: column;
      padding: 8px;
      overflow: auto;
    }

    .game-body {
      flex: 1;
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 8px;
    }

    .card {
      background: #ffffff;
      border-radius: 18px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.18);
      width: 100%;
      max-width: 900px;
      height: 100%;
      max-height: 100%;
      padding: 12px;
      display: flex;
      flex-direction: column;
      gap: 8px;
      overflow: auto;
    }

    .small-note {
      font-size: 0.8rem;
      color: #555;
    }

    .simple {
      border-radius: 999px;
      border: none;
      padding: 8px 16px;
      font-size: 0.9rem;
      cursor: pointer;
      background: #4c6fff;
      color: white;
      align-self: center;
      box-shadow: 0 3px 6px rgba(0,0,0,0.25);
    }

    .flex-row {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      align-items: center;
      gap: 8px;
    }

    /* MENU */

    #menu .screen-body {
      padding: 0;
    }

    .menu-grid-wrapper {
      flex: 1;
      overflow-y: auto;
      padding: 10px;
    }

    .menu-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
      gap: 10px;
    }

    .game-button {
      border: none;
      border-radius: 22px;
      padding: 16px 14px;
      font-size: 0.95rem;
      font-weight: 600;
      color: #fff;
      cursor: pointer;
      display: flex;
      flex-direction: column;
      align-items: flex-start;
      justify-content: center;
      box-shadow: 0 5px 10px rgba(0,0,0,0.22);
      transition: transform 0.12s ease, box-shadow 0.12s ease;
      text-align: left;
      min-height: 120px;
    }

    .game-button span.big {
      font-size: 1.15rem;
      margin-bottom: 4px;
    }

    .game-button:active {
      transform: translateY(2px);
      box-shadow: 0 2px 5px rgba(0,0,0,0.22);
    }

    .btn-1 { background: linear-gradient(135deg, #ff7eb3, #ff758c); }
    .btn-2 { background: linear-gradient(135deg, #6a85ff, #8e7bff); }
    .btn-3 { background: linear-gradient(135deg, #ffc25b, #ff9f1c); }
    .btn-4 { background: linear-gradient(135deg, #68d391, #3bb273); }
    .btn-5 { background: linear-gradient(135deg, #f56565, #ed64a6); }
    .btn-6 { background: linear-gradient(135deg, #38b2ac, #4299e1); }
    .btn-7 { background: linear-gradient(135deg, #ed64a6, #805ad5); }
    .btn-8 { background: linear-gradient(135deg, #f6ad55, #f97316); }
    .btn-9 { background: linear-gradient(135deg, #319795, #2b6cb0); }
    .btn-10 { background: linear-gradient(135deg, #4fd1c5, #667eea); }
    .btn-11 { background: linear-gradient(135deg, #ed8936, #dd6b20); }
    .btn-12 { background: linear-gradient(135deg, #9f7aea, #d53f8c); }
    .btn-13 { background: linear-gradient(135deg, #48bb78, #38a169); }
    .btn-14 { background: linear-gradient(135deg, #4299e1, #3182ce); }
    .btn-15 { background: linear-gradient(135deg, #f56565, #e53e3e); }

    /* GIOCO 1: DISEGNA */

    .toolbar {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      justify-content: center;
      align-items: center;
      font-size: 0.8rem;
    }

    .color-dot {
      width: 24px;
      height: 24px;
      border-radius: 999px;
      border: 2px solid #fff;
      box-shadow: 0 0 0 2px rgba(0,0,0,0.3);
      cursor: pointer;
    }

    .color-dot.active {
      box-shadow: 0 0 0 3px #333;
    }

    #drawCanvas {
      background: #ffffff;
      border-radius: 16px;
      box-shadow: 0 3px 8px rgba(0,0,0,0.25);
      touch-action: none;
      width: 100%;
      height: 70vh;
      display: block;
    }

    /* GIOCO 2: PUZZLE */

    .puzzle-grid {
      flex: 1;
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      grid-template-rows: repeat(2, 1fr);
      gap: 6px;
      min-height: 250px;
    }

    .puzzle-piece {
      border-radius: 14px;
      cursor: pointer;
      background: linear-gradient(135deg,#ff7eb3,#ff758c);
      box-shadow: 0 2px 6px rgba(0,0,0,0.25);
      border: 2px solid #fff;
      position: relative;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #ffffffdd;
      font-size: 2.5rem;
      font-weight: 800;
    }

    /* GIOCO 3: MEMORY */

    .memory-grid {
      display: grid;
      grid-template-columns: repeat(4, minmax(60px, 1fr));
      gap: 8px;
      justify-content: center;
    }

    .memory-card {
      aspect-ratio: 2/3;
      border-radius: 14px;
      background: #6b46c1;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-size: 1.7rem;
      cursor: pointer;
      box-shadow: 0 2px 4px rgba(0,0,0,0.25);
      user-select: none;
    }

    .memory-card.revealed {
      background: white;
      border: 2px solid #805ad5;
      color: #4a3c89;
    }

    /* GIOCO 4: XILOFONO */

    .xylophone {
      display: flex;
      flex-direction: column;
      gap: 10px;
      align-items: center;
      width: 100%;
      margin-top: 8px;
    }

    .xy-key {
      width: 95%;
      max-width: 500px;
      height: 46px;
      border-radius: 18px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.25);
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-size: 1rem;
      font-weight: 600;
      user-select: none;
    }

    /* GIOCO 5: ACCHIAPPA */

    .mole-grid {
      display: grid;
      grid-template-columns: repeat(3, 90px);
      grid-template-rows: repeat(3, 90px);
      gap: 8px;
      justify-content: center;
    }

    .mole-cell {
      width: 90px;
      height: 90px;
      border-radius: 20px;
      background: #e2e8f0;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 2.2rem;
      cursor: pointer;
      box-shadow: 0 2px 4px rgba(0,0,0,0.22);
      user-select: none;
    }

    /* GIOCO 6: FORME */

    .shape-row, .slot-row {
      display: flex;
      justify-content: center;
      gap: 12px;
      margin: 8px 0;
      flex-wrap: wrap;
    }

    .shape-item, .shape-slot {
      width: 80px;
      height: 80px;
      border-radius: 16px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: #edf2ff;
      box-shadow: 0 2px 4px rgba(0,0,0,0.18);
      font-size: 1.8rem;
    }

    .shape-slot {
      border: 2px dashed #a0aec0;
      color: #4a5568;
      font-size: 0.85rem;
    }

    .shape-slot.filled {
      border-style: solid;
      background: #c6f6d5;
    }

    .quiz-text {
      font-size: 1.3rem;
      margin-bottom: 8px;
      color: #2d3748;
      text-align: center;
    }

    .quiz-options {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 8px;
      margin-bottom: 6px;
    }

    .quiz-btn {
      min-width: 72px;
      border-radius: 999px;
      border: none;
      padding: 10px 16px;
      font-size: 1rem;
      cursor: pointer;
      background: #805ad5;
      color: white;
      box-shadow: 0 2px 4px rgba(0,0,0,0.22);
      user-select: none;
    }

    /* GIOCO 15: BOLLE FULL */

    .bubble-area {
      width: 100%;
      max-width: 100%;
      height: 65vh;
      border-radius: 22px;
      background: linear-gradient(180deg, #7fd3ff, #e0f7ff);
      position: relative;
      overflow: hidden;
      box-shadow: inset 0 0 0 1px rgba(255,255,255,0.9), 0 4px 10px rgba(0,0,0,0.25);
      margin: 8px auto 0;
    }

    .bubble {
      position: absolute;
      width: 56px;
      height: 56px;
      border-radius: 999px;
      border: 2px solid #ffffff;
      background: radial-gradient(circle at 30% 30%, #ffffff, #49b5ff);
      box-shadow: 0 0 14px rgba(73,181,255,0.9);
      cursor: pointer;
    }

    /* DRAG & DROP */

    .drag-item {
      padding: 6px 10px;
      border-radius: 999px;
      background: #fed7e2;
      font-size: 0.9rem;
      cursor: grab;
      box-shadow: 0 2px 4px rgba(0,0,0,0.18);
      white-space: nowrap;
    }

    .drop-zone {
      min-width: 100px;
      min-height: 70px;
      padding: 6px;
      border-radius: 16px;
      background: #e2e8f0;
      border: 2px dashed #a0aec0;
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      align-items: center;
      gap: 4px;
      font-size: 0.85rem;
      text-align: center;
    }

    .drop-zone.correct {
      background: #c6f6d5;
      border-style: solid;
    }

    /* CANVAS CORSA TRENINO */

    #trainCanvas {
      background:#e2e8f0;
      border-radius:20px;
      margin-top:8px;
      width:100%;
      max-width:100%;
      height:65vh;
      display:block;
    }

    @media (max-width: 700px) {
      .menu-grid {
        grid-template-columns: repeat(2, minmax(0,1fr));
      }
      .game-button {
        min-height: 115px;
      }
      .memory-grid {
        grid-template-columns: repeat(4, minmax(55px, 1fr));
      }
      .mole-grid {
        grid-template-columns: repeat(3, 80px);
        grid-template-rows: repeat(3, 80px);
      }
      .mole-cell {
        width:80px;
        height:80px;
      }
      .xy-key {
        height:44px;
      }
    }

    @media (max-width: 480px) {
      .menu-header h1 {
        font-size: 1.4rem;
      }
      .game-title {
        font-size: 1.05rem;
      }
      .card {
        border-radius: 12px;
        padding: 8px;
      }
      #drawCanvas {
        height: 65vh;
      }
    }
  </style>
</head>
<body>
  <div id="app">

    <!-- MENU -->
    <section id="menu" class="screen active">
      <div class="menu-header">
        <h1>üéà Mini Giochi Bambini</h1>
        <p>Tocca un gioco per iniziare!</p>
      </div>
      <div class="screen-body">
        <div class="menu-grid-wrapper">
          <div class="menu-grid">
            <button class="game-button btn-1" data-target="game-disegna">
              <span class="big">üé® Disegna</span>
              <span>Colora a schermo intero</span>
            </button>
            <button class="game-button btn-2" data-target="game-puzzle">
              <span class="big">üß© Puzzle 2x2</span>
              <span>Rimetti in ordine 1-4</span>
            </button>
            <button class="game-button btn-3" data-target="game-memory">
              <span class="big">üß† Memory</span>
              <span>Trova le coppie</span>
            </button>
            <button class="game-button btn-4" data-target="game-xilofono">
              <span class="big">üéµ Xilofono</span>
              <span>8 tasti colorati</span>
            </button>
            <button class="game-button btn-5" data-target="game-mole">
              <span class="big">üêµ Acchiappa!</span>
              <span>Tocca l'animale giusto</span>
            </button>
            <button class="game-button btn-6" data-target="game-forme">
              <span class="big">üî∫ Forme</span>
              <span>Metti al posto giusto</span>
            </button>
            <button class="game-button btn-7" data-target="game-numeri">
              <span class="big">üî¢ Numeri</span>
              <span>Che numero vedi?</span>
            </button>
            <button class="game-button btn-8" data-target="game-colori">
              <span class="big">üé® Colori</span>
              <span>Tocca il colore giusto</span>
            </button>
            <button class="game-button btn-9" data-target="game-giocattoli">
              <span class="big">üß∏ Giocattoli</span>
              <span>Ordina nelle scatole</span>
            </button>
            <button class="game-button btn-10" data-target="game-parco">
              <span class="big">üöÆ Parco Pulito</span>
              <span>Butta i rifiuti giusti</span>
            </button>
            <button class="game-button btn-11" data-target="game-corsa">
              <span class="big">üöÇ Corsa Treno</span>
              <span>Cambia binario</span>
            </button>
            <button class="game-button btn-12" data-target="game-trenino">
              <span class="big">üöÉ Costruisci Treno</span>
              <span>Metti i vagoni</span>
            </button>
            <button class="game-button btn-13" data-target="game-stelle">
              <span class="big">‚≠ê Conta Stelle</span>
              <span>Quante sono?</span>
            </button>
            <button class="game-button btn-14" data-target="game-animale-suono">
              <span class="big">üêÆ Che verso?</span>
              <span>Trova l'animale</span>
            </button>
            <button class="game-button btn-15" data-target="game-bolle">
              <span class="big">ü´ß Bolle</span>
              <span>Scoppiale tutte!</span>
            </button>
          </div>
        </div>
      </div>
    </section>

    <!-- GIOCO 1: DISEGNA -->
    <section id="game-disegna" class="screen">
      <div class="game-header">
        <button class="back-btn" data-home>üè† Home</button>
        <div class="game-title">üé® Disegna a schermo intero</div>
      </div>
      <div class="screen-body">
        <div class="game-body">
          <div class="card">
            <div class="toolbar">
              <span>Colore:</span>
              <div class="color-dot" data-color="#ff4b6e" style="background:#ff4b6e"></div>
              <div class="color-dot" data-color="#ffb800" style="background:#ffb800"></div>
              <div class="color-dot" data-color="#20c997" style="background:#20c997"></div>
              <div class="color-dot" data-color="#3b82f6" style="background:#3b82f6"></div>
              <div class="color-dot" data-color="#000000" style="background:#000000"></div>
              <span>Spessore:</span>
              <select id="brushSize">
                <option value="3">Piccolo</option>
                <option value="6" selected>Medio</option>
                <option value="10">Grosso</option>
              </select>
              <button class="simple" id="clearCanvas">Pulisci</button>
            </div>
            <canvas id="drawCanvas"></canvas>
            <div class="small-note">Usa il dito o il mouse per disegnare a schermo pieno.</div>
          </div>
        </div>
      </div>
    </section>

    <!-- GIOCO 2: PUZZLE -->
    <section id="game-puzzle" class="screen">
      <div class="game-header">
        <button class="back-btn" data-home>üè† Home</button>
        <div class="game-title">üß© Puzzle 2x2</div>
      </div>
      <div class="screen-body">
        <div class="game-body">
          <div class="card">
            <div class="small-note">Tocca due tessere per scambiarle. Metti i numeri in ordine 1-4.</div>
            <div class="puzzle-grid" id="puzzleGrid"></div>
            <button class="simple" id="puzzleReset">Mescola</button>
            <div id="puzzleMsg" class="small-note"></div>
          </div>
        </div>
      </div>
    </section>

    <!-- GIOCO 3: MEMORY -->
    <section id="game-memory" class="screen">
      <div class="game-header">
        <button class="back-btn" data-home>üè† Home</button>
        <div class="game-title">üß† Memory</div>
      </div>
      <div class="screen-body">
        <div class="game-body">
          <div class="card">
            <div class="small-note">Tocca due carte per volta e trova tutte le coppie.</div>
            <div class="memory-grid" id="memoryGrid"></div>
            <button class="simple" id="memoryReset">Nuova partita</button>
            <div id="memoryMsg" class="small-note"></div>
          </div>
        </div>
      </div>
    </section>

    <!-- GIOCO 4: XILOFONO -->
    <section id="game-xilofono" class="screen">
      <div class="game-header">
        <button class="back-btn" data-home>üè† Home</button>
        <div class="game-title">üéµ Xilofono</div>
      </div>
      <div class="screen-body">
        <div class="game-body">
          <div class="card">
            <div class="small-note">Tocca i tasti grandi e colorati per suonare.</div>
            <div class="xylophone" id="xylophone"></div>
          </div>
        </div>
      </div>
    </section>

    <!-- GIOCO 5: ACCHIAPPA -->
    <section id="game-mole" class="screen">
      <div class="game-header">
        <button class="back-btn" data-home>üè† Home</button>
        <div class="game-title">üêµ Acchiappa l'animale</div>
      </div>
      <div class="screen-body">
        <div class="game-body">
          <div class="card">
            <div class="small-note">Tocca l'animale quando compare. Hai 30 secondi!</div>
            <div>Tempo: <span id="moleTime">30</span>s ¬∑ Punti: <span id="moleScore">0</span></div>
            <div class="mole-grid" id="moleGrid"></div>
            <button class="simple" id="moleStart">Start</button>
            <div id="moleMsg" class="small-note"></div>
          </div>
        </div>
      </div>
    </section>

    <!-- GIOCO 6: FORME -->
    <section id="game-forme" class="screen">
      <div class="game-header">
        <button class="back-btn" data-home>üè† Home</button>
        <div class="game-title">üî∫ Forme</div>
      </div>
      <div class="screen-body">
        <div class="game-body">
          <div class="card">
            <div class="small-note">Trascina ogni forma nel suo posto.</div>
            <div class="shape-row" id="shapeRow"></div>
            <div class="slot-row" id="slotRow"></div>
            <div id="formeMsg" class="small-note"></div>
          </div>
        </div>
      </div>
    </section>

    <!-- GIOCO 7: NUMERI -->
    <section id="game-numeri" class="screen">
      <div class="game-header">
        <button class="back-btn" data-home>üè† Home</button>
        <div class="game-title">üî¢ Numeri</div>
      </div>
      <div class="screen-body">
        <div class="game-body">
          <div class="card">
            <div class="quiz-text" id="numQuestion"></div>
            <div class="quiz-options" id="numOptions"></div>
            <div id="numMsg" class="small-note"></div>
          </div>
        </div>
      </div>
    </section>

    <!-- GIOCO 8: COLORI -->
    <section id="game-colori" class="screen">
      <div class="game-header">
        <button class="back-btn" data-home>üè† Home</button>
        <div class="game-title">üé® Colori</div>
      </div>
      <div class="screen-body">
        <div class="game-body">
          <div class="card">
            <div class="quiz-text" id="colorQuestion"></div>
            <div class="quiz-options" id="colorOptions"></div>
            <div id="colorMsg" class="small-note"></div>
          </div>
        </div>
      </div>
    </section>

    <!-- GIOCO 9: GIOCATTOLI -->
    <section id="game-giocattoli" class="screen">
      <div class="game-header">
        <button class="back-btn" data-home>üè† Home</button>
        <div class="game-title">üß∏ Ordina i giocattoli</div>
      </div>
      <div class="screen-body">
        <div class="game-body">
          <div class="card">
            <div class="small-note">Trascina i giocattoli nella scatola giusta.</div>
            <div class="flex-row" id="toyItems"></div>
            <div class="flex-row">
              <div class="drop-zone" data-type="animale">Animali</div>
              <div class="drop-zone" data-type="palla">Palle</div>
              <div class="drop-zone" data-type="auto">Auto</div>
            </div>
            <div id="toyMsg" class="small-note"></div>
          </div>
        </div>
      </div>
    </section>

    <!-- GIOCO 10: PARCO PULITO -->
    <section id="game-parco" class="screen">
      <div class="game-header">
        <button class="back-btn" data-home>üè† Home</button>
        <div class="game-title">üöÆ Parco pulito</div>
      </div>
      <div class="screen-body">
        <div class="game-body">
          <div class="card">
            <div class="small-note">Trascina i rifiuti nel cestino giusto.</div>
            <div class="flex-row" id="trashItems"></div>
            <div class="flex-row">
              <div class="drop-zone" data-type="plastica">Plastica</div>
              <div class="drop-zone" data-type="carta">Carta</div>
              <div class="drop-zone" data-type="vetro">Vetro</div>
            </div>
            <div id="trashMsg" class="small-note"></div>
          </div>
        </div>
      </div>
    </section>

    <!-- GIOCO 11: CORSA TRENINO -->
    <section id="game-corsa" class="screen">
      <div class="game-header">
        <button class="back-btn" data-home>üè† Home</button>
        <div class="game-title">üöÇ Corsa del treno</div>
      </div>
      <div class="screen-body">
        <div class="game-body">
          <div class="card">
            <div class="small-note">Usa ‚óÄÔ∏è e ‚ñ∂Ô∏è o i pulsanti per cambiare binario e evitare gli ostacoli.</div>
            <div class="flex-row">
              <button class="simple" id="trainLeft">‚óÄÔ∏è</button>
              <button class="simple" id="trainRight">‚ñ∂Ô∏è</button>
              <button class="simple" id="trainStart">Start</button>
            </div>
            <canvas id="trainCanvas"></canvas>
            <div id="trainMsg" class="small-note"></div>
          </div>
        </div>
      </div>
    </section>

    <!-- GIOCO 12: COSTRUISCI TRENINO -->
    <section id="game-trenino" class="screen">
      <div class="game-header">
        <button class="back-btn" data-home>üè† Home</button>
        <div class="game-title">üöÉ Costruisci il trenino</div>
      </div>
      <div class="screen-body">
        <div class="game-body">
          <div class="card">
            <div class="small-note">Trascina i vagoni negli spazi.</div>
            <div class="flex-row" id="trainParts"></div>
            <div class="flex-row" id="trainSlots"></div>
            <div id="buildTrainMsg" class="small-note"></div>
          </div>
        </div>
      </div>
    </section>

    <!-- GIOCO 13: CONTA STELLE -->
    <section id="game-stelle" class="screen">
      <div class="game-header">
        <button class="back-btn" data-home>üè† Home</button>
        <div class="game-title">‚≠ê Conta le stelle</div>
      </div>
      <div class="screen-body">
        <div class="game-body">
          <div class="card">
            <div id="starsDisplay" style="font-size:2.4rem;text-align:center;margin-bottom:4px;"></div>
            <div class="quiz-options" id="starsOptions"></div>
            <div id="starsMsg" class="small-note"></div>
          </div>
        </div>
      </div>
    </section>

    <!-- GIOCO 14: SUONI ANIMALI -->
    <section id="game-animale-suono" class="screen">
      <div class="game-header">
        <button class="back-btn" data-home>üè† Home</button>
        <div class="game-title">üêÆ Che verso fa?</div>
      </div>
      <div class="screen-body">
        <div class="game-body">
          <div class="card">
            <div class="quiz-text" id="soundQuestion"></div>
            <button class="simple" id="soundPlay">üîä Ascolta di nuovo</button>
            <div class="quiz-options" id="soundOptions"></div>
            <div id="soundMsg" class="small-note"></div>
          </div>
        </div>
      </div>
    </section>

    <!-- GIOCO 15: BOLLE -->
    <section id="game-bolle" class="screen">
      <div class="game-header">
        <button class="back-btn" data-home>üè† Home</button>
        <div class="game-title">ü´ß Rompi le bolle</div>
      </div>
      <div class="screen-body">
        <div class="game-body">
          <div class="card">
            <div>Bollette scoppiate: <span id="bubbleScore">0</span></div>
            <div class="bubble-area" id="bubbleArea"></div>
            <button class="simple" id="bubbleStart">Start</button>
            <div class="small-note">Tocca le bolle per farle scoppiare!</div>
          </div>
        </div>
      </div>
    </section>

  </div>

  <script>
    let audioCtx = null;
    function ensureAudioContext() {
      if (!audioCtx) {
        audioCtx = new (window.AudioContext || window.webkitAudioContext)();
      }
    }

    function playTone(freq, duration = 0.25, type = 'sine', vol = 0.25) {
      ensureAudioContext();
      const osc = audioCtx.createOscillator();
      const gain = audioCtx.createGain();
      osc.frequency.value = freq;
      osc.type = type;
      osc.connect(gain);
      gain.connect(audioCtx.destination);
      const now = audioCtx.currentTime;
      gain.gain.setValueAtTime(0.0001, now);
      gain.gain.exponentialRampToValueAtTime(vol, now + 0.01);
      gain.gain.exponentialRampToValueAtTime(0.0001, now + duration);
      osc.start(now);
      osc.stop(now + duration);
    }

    function playClick()   { playTone(600, 0.08, 'square', 0.15); }
    function playSuccess() { playTone(880, 0.2, 'triangle', 0.25); }
    function playError()   { playTone(200, 0.25, 'sawtooth', 0.2); }

    const screens = document.querySelectorAll('.screen');
    let resizeDrawCanvas;
    let resizeTrainCanvas;

    function showScreen(id) {
      screens.forEach(s => s.classList.remove('active'));
      document.getElementById(id).classList.add('active');

      if (id === 'game-disegna' && typeof resizeDrawCanvas === 'function') {
        resizeDrawCanvas();
      }
      if (id === 'game-corsa' && typeof resizeTrainCanvas === 'function') {
        resizeTrainCanvas();
      }
    }

    document.querySelectorAll('.game-button').forEach(btn => {
      btn.addEventListener('click', () => {
        playClick();
        showScreen(btn.getAttribute('data-target'));
      });
    });

    document.querySelectorAll('[data-home]').forEach(btn => {
      btn.addEventListener('click', () => {
        playClick();
        showScreen('menu');
      });
    });

    /* ------------ DISEGNA ------------ */
    (function() {
      const canvas = document.getElementById('drawCanvas');
      const ctx = canvas.getContext('2d');
      let drawing = false;
      let color = '#ff4b6e';
      let size = 6;

      resizeDrawCanvas = function() {
        const rect = canvas.parentElement.getBoundingClientRect();
        const width = rect.width - 10;
        const height = Math.max(window.innerHeight * 0.65, 260);
        canvas.width = width;
        canvas.height = height;
      };

      window.addEventListener('resize', () => {
        if (document.getElementById('game-disegna').classList.contains('active')) {
          resizeDrawCanvas();
        }
      });

      function getPos(e) {
        const rect = canvas.getBoundingClientRect();
        if (e.touches && e.touches[0]) {
          return {
            x: e.touches[0].clientX - rect.left,
            y: e.touches[0].clientY - rect.top
          };
        } else {
          return {
            x: e.clientX - rect.left,
            y: e.clientY - rect.top
          };
        }
      }

      function startDraw(e) {
        ensureAudioContext();
        drawing = true;
        const pos = getPos(e);
        ctx.beginPath();
        ctx.moveTo(pos.x, pos.y);
      }

      function draw(e) {
        if (!drawing) return;
        e.preventDefault();
        const pos = getPos(e);
        ctx.lineTo(pos.x, pos.y);
        ctx.strokeStyle = color;
        ctx.lineWidth = size;
        ctx.lineCap = 'round';
        ctx.lineJoin = 'round';
        ctx.stroke();
      }

      function endDraw() {
        drawing = false;
        ctx.closePath();
      }

      canvas.addEventListener('mousedown', startDraw);
      canvas.addEventListener('mousemove', draw);
      canvas.addEventListener('mouseup', endDraw);
      canvas.addEventListener('mouseleave', endDraw);
      canvas.addEventListener('touchstart', startDraw, {passive:false});
      canvas.addEventListener('touchmove', draw, {passive:false});
      canvas.addEventListener('touchend', endDraw);

      document.querySelectorAll('.color-dot').forEach(dot => {
        dot.addEventListener('click', () => {
          document.querySelectorAll('.color-dot').forEach(d => d.classList.remove('active'));
          dot.classList.add('active');
          color = dot.getAttribute('data-color');
          playClick();
        });
      });
      document.querySelector('.color-dot').classList.add('active');

      document.getElementById('brushSize').addEventListener('change', e => {
        size = parseInt(e.target.value, 10);
        playClick();
      });

      document.getElementById('clearCanvas').addEventListener('click', () => {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        playClick();
      });

      resizeDrawCanvas();
    })();

    /* ------------ PUZZLE ------------ */
    (function() {
      const grid = document.getElementById('puzzleGrid');
      const msg = document.getElementById('puzzleMsg');
      const resetBtn = document.getElementById('puzzleReset');
      const piecesData = [
        {id:0, num:1},
        {id:1, num:2},
        {id:2, num:3},
        {id:3, num:4}
      ];
      let current = [];
      let first = null;

      function shuffle(arr) {
        for (let i = arr.length - 1; i > 0; i--) {
          const j = Math.floor(Math.random() * (i + 1));
          [arr[i], arr[j]] = [arr[j], arr[i]];
        }
      }

      function render() {
        grid.innerHTML = '';
        current.forEach((p, idx) => {
          const div = document.createElement('div');
          div.className = 'puzzle-piece';
          div.dataset.index = idx;
          div.textContent = p.num;
          div.addEventListener('click', () => onClick(idx));
          grid.appendChild(div);
        });
      }

      function onClick(idx) {
        if (first === null) {
          first = idx;
          msg.textContent = 'Ora tocca un altro pezzo.';
          playClick();
        } else if (first === idx) {
          first = null;
        } else {
          [current[first], current[idx]] = [current[idx], current[first]];
          first = null;
          render();
          checkWin();
          playClick();
        }
      }

      function checkWin() {
        const ok = current.every((p, i) => p.id === i);
        if (ok) {
          msg.textContent = 'Bravo! Puzzle in ordine 1-4! üéâ';
          playSuccess();
        } else {
          msg.textContent = '';
        }
      }

      function reset() {
        current = piecesData.slice();
        shuffle(current);
        first = null;
        render();
        msg.textContent = '';
      }
      resetBtn.addEventListener('click', () => { reset(); playClick(); });
      reset();
    })();

    /* ------------ MEMORY ------------ */
    (function() {
      const grid = document.getElementById('memoryGrid');
      const resetBtn = document.getElementById('memoryReset');
      const msg = document.getElementById('memoryMsg');
      const icons = ['üê∂','üê±','üê≠','üê∏','üêº','üê®'];
      let cards = [];
      let firstIdx = null;
      let lock = false;
      let found = 0;

      function setup() {
        const base = icons.slice(0,6);
        const arr = base.concat(base).map((icon, index) => ({
          id:index, icon, revealed:false, matched:false
        }));
        for (let i = arr.length - 1; i > 0; i--) {
          const j = Math.floor(Math.random() * (i + 1));
          [arr[i], arr[j]] = [arr[j], arr[i]];
        }
        cards = arr;
        found = 0;
        firstIdx = null;
        lock = false;
        render();
        msg.textContent = '';
      }

      function render() {
        grid.innerHTML = '';
        cards.forEach((c, i) => {
          const div = document.createElement('div');
          div.className = 'memory-card';
          if (c.revealed || c.matched) {
            div.classList.add('revealed');
            div.textContent = c.icon;
          } else {
            div.textContent = '‚ùì';
          }
          if (!c.matched) {
            div.addEventListener('click', () => onClick(i));
          }
          grid.appendChild(div);
        });
      }

      function onClick(index) {
        if (lock) return;
        const card = cards[index];
        if (card.revealed || card.matched) return;
        card.revealed = true;
        render();
        playClick();
        if (firstIdx === null) {
          firstIdx = index;
        } else {
          lock = true;
          const firstCard = cards[firstIdx];
          if (firstCard.icon === card.icon) {
            firstCard.matched = true;
            card.matched = true;
            found += 2;
            msg.textContent = 'Coppia trovata! ‚ú®';
            playSuccess();
            firstIdx = null;
            lock = false;
            render();
            if (found === cards.length) {
              msg.textContent = 'Bravo! Hai trovato tutte le coppie! üéâ';
            }
          } else {
            playError();
            setTimeout(() => {
              firstCard.revealed = false;
              card.revealed = false;
              firstIdx = null;
              lock = false;
              render();
              msg.textContent = '';
            }, 700);
          }
        }
      }

      resetBtn.addEventListener('click', () => { setup(); playClick(); });
      setup();
    })();

    /* ------------ XILOFONO ------------ */
    (function() {
      const container = document.getElementById('xylophone');
      const notes  = [261.63, 293.66, 329.63, 349.23, 392.00, 440.00, 493.88, 523.25];
      const names  = ['Do', 'Re', 'Mi', 'Fa', 'Sol', 'La', 'Si', 'Do'];
      const colors = [
        '#ff7eb3', '#ff9f1c', '#f6e05e', '#68d391',
        '#4299e1', '#9f7aea', '#ed64a6', '#f56565'
      ];

      notes.forEach((freq, i) => {
        const div = document.createElement('div');
        div.className = 'xy-key';
        div.textContent = names[i];
        div.style.background = colors[i];
        div.addEventListener('click', () => {
          playTone(freq, 0.35, 'triangle', 0.3);
        });
        container.appendChild(div);
      });
    })();

    /* ------------ ACCHIAPPA ------------ */
    (function() {
      const grid = document.getElementById('moleGrid');
      const timeSpan = document.getElementById('moleTime');
      const scoreSpan = document.getElementById('moleScore');
      const msg = document.getElementById('moleMsg');
      const btn = document.getElementById('moleStart');
      const animals = ['üê∂','üê±','üê∞','üêµ','üêª','üêº'];
      let interval = null;
      let timerInterval = null;
      let timeLeft = 30;
      let score = 0;
      let activeIndex = -1;

      for (let i=0;i<9;i++) {
        const cell = document.createElement('div');
        cell.className = 'mole-cell';
        cell.dataset.index = i;
        cell.addEventListener('click', () => {
          if (parseInt(cell.dataset.index,10) === activeIndex && cell.textContent !== '') {
            score++;
            scoreSpan.textContent = score;
            cell.textContent = '';
            activeIndex = -1;
            playSuccess();
          } else {
            if (cell.textContent === '') return;
            playError();
          }
        });
        grid.appendChild(cell);
      }

      function clearCells() {
        grid.querySelectorAll('.mole-cell').forEach(c => c.textContent = '');
      }

      function step() {
        clearCells();
        const idx = Math.floor(Math.random()*9);
        const icon = animals[Math.floor(Math.random()*animals.length)];
        const cell = grid.querySelector(`.mole-cell[data-index="${idx}"]`);
        if (cell) {
          cell.textContent = icon;
          activeIndex = idx;
        }
      }

      function startGame() {
        if (interval) return;
        playClick();
        timeLeft = 30;
        score = 0;
        scoreSpan.textContent = score;
        timeSpan.textContent = timeLeft;
        msg.textContent = '';
        interval = setInterval(step, 700);
        timerInterval = setInterval(() => {
          timeLeft--;
          timeSpan.textContent = timeLeft;
          if (timeLeft <= 0) {
            stopGame();
            msg.textContent = 'Tempo finito! Punteggio: ' + score + ' üéâ';
          }
        }, 1000);
      }

      function stopGame() {
        clearInterval(interval);
        clearInterval(timerInterval);
        interval = null;
        timerInterval = null;
        clearCells();
        activeIndex = -1;
      }

      btn.addEventListener('click', startGame);
    })();

    /* ------------ FORME ------------ */
    (function() {
      const shapes = [
        {id:'cerchio', label:'‚ö™'},
        {id:'quadrato', label:'üü•'},
        {id:'triangolo', label:'üî∫'}
      ];
      const row = document.getElementById('shapeRow');
      const slots = document.getElementById('slotRow');
      const msg = document.getElementById('formeMsg');
      let done = 0;

      function reset() {
        row.innerHTML = '';
        slots.innerHTML = '';
        done = 0;
        msg.textContent = '';

        shapes.forEach(s => {
          const div = document.createElement('div');
          div.className = 'shape-item';
          div.textContent = s.label;
          div.draggable = true;
          div.dataset.id = s.id;
          div.addEventListener('dragstart', e => {
            e.dataTransfer.setData('text/plain', s.id);
          });
          row.appendChild(div);
        });

        shapes.forEach(s => {
          const slot = document.createElement('div');
          slot.className = 'shape-slot';
          slot.textContent = s.id;
          slot.dataset.id = s.id;
          slot.addEventListener('dragover', e => e.preventDefault());
          slot.addEventListener('drop', e => {
            e.preventDefault();
            const id = e.dataTransfer.getData('text/plain');
            if (!id) return;
            if (slot.dataset.id === id && !slot.classList.contains('filled')) {
              const dragged = row.querySelector(`[data-id="${id}"]`);
              if (dragged) dragged.style.visibility = 'hidden';
              slot.classList.add('filled');
              slot.textContent = shapes.find(sh => sh.id === id).label;
              done++;
              playSuccess();
              if (done === shapes.length) {
                msg.textContent = 'Bravissimo! Tutte le forme al posto giusto! üéâ';
              }
            } else {
              playError();
            }
          });
          slots.appendChild(slot);
        });
      }
      reset();
    })();

    /* ------------ HELPER QUIZ ------------ */
    function createQuiz(containerOptions, options, correctValue, onResult) {
      containerOptions.innerHTML = '';
      options.forEach(val => {
        const btn = document.createElement('button');
        btn.className = 'quiz-btn';
        btn.textContent = val.label || val;
        if (val.color) btn.style.background = val.color;
        btn.addEventListener('click', () => {
          onResult(val.value || val);
        });
        containerOptions.appendChild(btn);
      });
    }

    /* ------------ NUMERI (AUTOPLAY) ------------ */
    (function() {
      const q = document.getElementById('numQuestion');
      const optionsDiv = document.getElementById('numOptions');
      const msg = document.getElementById('numMsg');
      let current = 0;

      function renderQuestion() {
        q.innerHTML = `Che numero vedi?<br>
          <span style="font-size:44px;font-weight:700;color:#4a3c89;display:inline-block;margin-top:6px;">
            ${current}
          </span>`;
      }

      function newRound() {
        msg.textContent = '';
        current = Math.floor(Math.random()*9) + 1;
        renderQuestion();
        const answers = [current];
        while (answers.length < 4) {
          const n = Math.floor(Math.random()*9) + 1;
          if (!answers.includes(n)) answers.push(n);
        }
        answers.sort(() => Math.random()-0.5);
        createQuiz(optionsDiv, answers, current, val => {
          if (val === current) {
            msg.textContent = 'Giusto! üëè';
            playSuccess();
            setTimeout(newRound, 900);
          } else {
            msg.textContent = 'Riprova üòä';
            playError();
          }
        });
      }
      newRound();
    })();

    /* ------------ COLORI (AUTOPLAY) ------------ */
    (function() {
      const q = document.getElementById('colorQuestion');
      const optionsDiv = document.getElementById('colorOptions');
      const msg = document.getElementById('colorMsg');
      const colors = [
        {name:'ROSSO', color:'#f56565'},
        {name:'GIALLO', color:'#ecc94b'},
        {name:'VERDE', color:'#48bb78'},
        {name:'BLU', color:'#4299e1'}
      ];
      let current = null;

      function newRound() {
        msg.textContent = '';
        current = colors[Math.floor(Math.random()*colors.length)];
        q.textContent = `Tocca il colore: ${current.name}`;
        const opts = colors.map(c => ({value:c.name, label:c.name.substring(0,1), color:c.color}));
        createQuiz(optionsDiv, opts, current.name, val => {
          if (val === current.name) {
            msg.textContent = 'Bravo, colore giusto! üé®';
            playSuccess();
            setTimeout(newRound, 900);
          } else {
            msg.textContent = 'Ops, prova di nuovo üòä';
            playError();
          }
        });
      }
      newRound();
    })();

    /* ------------ GIOCATTOLI ------------ */
    (function() {
      const itemsDiv = document.getElementById('toyItems');
      const msg = document.getElementById('toyMsg');
      const items = [
        {name:'üêª Orsetto', type:'animale'},
        {name:'üê∂ Cagnolino', type:'animale'},
        {name:'‚öΩ Pallone', type:'palla'},
        {name:'üèÄ Palla Basket', type:'palla'},
        {name:'üöó Macchina', type:'auto'},
        {name:'üöô Jeep', type:'auto'}
      ];
      let placed = 0;

      function reset() {
        itemsDiv.innerHTML = '';
        placed = 0;
        msg.textContent = '';

        items.forEach((it, index) => {
          const d = document.createElement('div');
          d.className = 'drag-item';
          d.textContent = it.name;
          d.draggable = true;
          d.dataset.type = it.type;
          d.id = 'toy-' + index;
          d.addEventListener('dragstart', e => {
            e.dataTransfer.setData('text/plain', d.id);
          });
          itemsDiv.appendChild(d);
        });

        document.querySelectorAll('#game-giocattoli .drop-zone').forEach(zone => {
          zone.classList.remove('correct');

          zone.addEventListener('dragover', e => e.preventDefault());

          zone.addEventListener('drop', e => {
            e.preventDefault();
            const draggedId = e.dataTransfer.getData('text/plain');
            const dragged = document.getElementById(draggedId);
            if (!dragged) return;
            const type = dragged.dataset.type;

            if (zone.dataset.type === type) {
              zone.appendChild(dragged);
              dragged.draggable = false;
              dragged.style.cursor = 'default';
              placed++;
              playSuccess();

              if (placed === items.length) {
                msg.textContent = 'Tutti i giocattoli sono al posto giusto! üéâ';
                document.querySelectorAll('#game-giocattoli .drop-zone').forEach(z => z.classList.add('correct'));
              }
            } else {
              msg.textContent = 'Non √® la scatola giusta üòÑ';
              playError();
            }
          });
        });
      }
      reset();
    })();

    /* ------------ PARCO PULITO ------------ */
    (function() {
      const itemsDiv = document.getElementById('trashItems');
      const msg = document.getElementById('trashMsg');
      const items = [
        {name:'ü•§ Bottiglia', type:'plastica'},
        {name:'üß¥ Flacone', type:'plastica'},
        {name:'üìÑ Foglio', type:'carta'},
        {name:'üì∞ Giornale', type:'carta'},
        {name:'üçæ Bottiglia vetro', type:'vetro'},
        {name:'üç∂ Vaso', type:'vetro'}
      ];
      let placed = 0;

      function reset() {
        itemsDiv.innerHTML = '';
        placed = 0;
        msg.textContent = '';

        items.forEach((it, index) => {
          const d = document.createElement('div');
          d.className = 'drag-item';
          d.textContent = it.name;
          d.draggable = true;
          d.dataset.type = it.type;
          d.id = 'trash-' + index;
          d.addEventListener('dragstart', e => {
            e.dataTransfer.setData('text/plain', d.id);
          });
          itemsDiv.appendChild(d);
        });

        document.querySelectorAll('#game-parco .drop-zone').forEach(zone => {
          zone.classList.remove('correct');
          zone.addEventListener('dragover', e => e.preventDefault());
          zone.addEventListener('drop', e => {
            e.preventDefault();
            const draggedId = e.dataTransfer.getData('text/plain');
            const dragged = document.getElementById(draggedId);
            if (!dragged) return;
            const type = dragged.dataset.type;

            if (zone.dataset.type === type) {
              zone.appendChild(dragged);
              dragged.draggable = false;
              dragged.style.cursor = 'default';
              placed++;
              playSuccess();

              if (placed === items.length) {
                msg.textContent = 'Parco pulitissimo! üå≥‚ú®';
                document.querySelectorAll('#game-parco .drop-zone').forEach(z => z.classList.add('correct'));
              }
            } else {
              msg.textContent = 'Questo non va qui üòâ';
              playError();
            }
          });
        });
      }
      reset();
    })();

    /* ------------ CORSA TRENINO ------------ */
    (function() {
      const canvas = document.getElementById('trainCanvas');
      const ctx = canvas.getContext('2d');
      const btnL = document.getElementById('trainLeft');
      const btnR = document.getElementById('trainRight');
      const btnStart = document.getElementById('trainStart');
      const msg = document.getElementById('trainMsg');

      let lane = 1;
      let obstacles = [];
      let running = false;
      let animId;

      function draw() {
        const w = canvas.width;
        const h = canvas.height;
        ctx.clearRect(0,0,w,h);
        const laneWidth = w / 3;
        ctx.strokeStyle = '#cbd5e0';
        ctx.lineWidth = 2;
        ctx.setLineDash([6,6]);
        for (let i=1;i<3;i++) {
          ctx.beginPath();
          ctx.moveTo(laneWidth*i, 0);
          ctx.lineTo(laneWidth*i, h);
          ctx.stroke();
        }
        ctx.setLineDash([]);

        const trainX = laneWidth * lane + laneWidth/2;
        const trainY = h - 40;
        ctx.fillStyle = '#805ad5';
        ctx.fillRect(trainX-22, trainY-14, 44, 28);
        ctx.fillStyle = '#2d3748';
        ctx.fillRect(trainX-15, trainY-22, 30, 10);
        ctx.fillStyle = '#2d3748';
        ctx.beginPath();
        ctx.arc(trainX-12, trainY+14, 6, 0, Math.PI*2);
        ctx.arc(trainX+12, trainY+14, 6, 0, Math.PI*2);
        ctx.fill();

        ctx.fillStyle = '#e53e3e';
        obstacles.forEach(o => {
          const x = laneWidth*o.lane + laneWidth/2;
          ctx.fillRect(x-14, o.y-14, 28, 28);
        });
      }

      function update() {
        if (!running) return;
        if (Math.random() < 0.03) {
          obstacles.push({lane:Math.floor(Math.random()*3), y:-10});
        }
        obstacles.forEach(o => o.y += 3);
        obstacles = obstacles.filter(o => o.y < canvas.height + 20);

        const laneWidth = canvas.width / 3;
        const trainY = canvas.height - 40;
        for (const o of obstacles) {
          if (o.lane === lane && Math.abs(o.y - trainY) < 30) {
            running = false;
            msg.textContent = 'Ops! Hai preso un ostacolo üöß';
            playError();
          }
        }
        draw();
        if (running) {
          animId = requestAnimationFrame(update);
        }
      }

      function resetGame() {
        lane = 1;
        obstacles = [];
        running = false;
        cancelAnimationFrame(animId);
        msg.textContent = '';
        draw();
      }

      btnL.addEventListener('click', () => {
        if (lane > 0) lane--;
        draw();
        playClick();
      });
      btnR.addEventListener('click', () => {
        if (lane < 2) lane++;
        draw();
        playClick();
      });
      btnStart.addEventListener('click', () => {
        resetGame();
        running = true;
        playClick();
        update();
      });

      document.addEventListener('keydown', e => {
        if (!document.getElementById('game-corsa').classList.contains('active')) return;
        if (e.key === 'ArrowLeft')  { if (lane > 0) lane--; draw(); }
        if (e.key === 'ArrowRight') { if (lane < 2) lane++; draw(); }
      });

      resizeTrainCanvas = function() {
        const rect = canvas.parentElement.getBoundingClientRect();
        canvas.width  = rect.width;
        canvas.height = rect.height - 20;
        draw();
      };
      window.addEventListener('resize', resizeTrainCanvas);
      resizeTrainCanvas();
    })();

    /* ------------ COSTRUISCI TRENINO ------------ */
    (function() {
      const partsDiv = document.getElementById('trainParts');
      const slotsDiv = document.getElementById('trainSlots');
      const msg = document.getElementById('buildTrainMsg');
      const parts = [
        {id:'locomotiva', label:'üöÇ'},
        {id:'vagone1', label:'üöÉ'},
        {id:'vagone2', label:'üöÉ'}
      ];
      let placed = 0;

      function reset() {
        partsDiv.innerHTML = '';
        slotsDiv.innerHTML = '';
        placed = 0;
        msg.textContent = '';

        parts.forEach(p => {
          const d = document.createElement('div');
          d.className = 'drag-item';
          d.textContent = p.label + ' ' + p.id;
          d.draggable = true;
          d.dataset.id = p.id;
          d.addEventListener('dragstart', e => {
            e.dataTransfer.setData('text/plain', p.id);
          });
          partsDiv.appendChild(d);
        });

        parts.forEach(p => {
          const slot = document.createElement('div');
          slot.className = 'drop-zone';
          slot.textContent = p.id.toUpperCase();
          slot.dataset.id = p.id;
          slot.addEventListener('dragover', e => e.preventDefault());
          slot.addEventListener('drop', e => {
            e.preventDefault();
            const id = e.dataTransfer.getData('text/plain');
            if (id === p.id && !slot.classList.contains('correct')) {
              let el = null;
              partsDiv.querySelectorAll('.drag-item').forEach(x => {
                if (x.dataset.id === id) el = x;
              });
              if (el) el.style.display = 'none';
              const chip = document.createElement('div');
              chip.className = 'drag-item';
              chip.textContent = p.label;
              chip.draggable = false;
              slot.appendChild(chip);
              slot.classList.add('correct');
              placed++;
              playSuccess();
              if (placed === parts.length) {
                msg.textContent = 'Trenino completo! üöÇüöÉüöÉüéâ';
              }
            } else {
              playError();
              msg.textContent = 'Questo pezzo non va qui üòä';
            }
          });
          slotsDiv.appendChild(slot);
        });
      }
      reset();
    })();

    /* ------------ CONTA STELLE (AUTOPLAY) ------------ */
    (function() {
      const display = document.getElementById('starsDisplay');
      const optsDiv = document.getElementById('starsOptions');
      const msg = document.getElementById('starsMsg');
      let current = 0;

      function newRound() {
        msg.textContent = '';
        current = Math.floor(Math.random()*8) + 1;
        display.textContent = '‚≠ê'.repeat(current);
        const answers = [current];
        while (answers.length < 4) {
          const n = Math.floor(Math.random()*8) + 1;
          if (!answers.includes(n)) answers.push(n);
        }
        answers.sort(() => Math.random()-0.5);
        createQuiz(optsDiv, answers, current, val => {
          if (val === current) {
            msg.textContent = 'Giusto! ‚≠ê';
            playSuccess();
            setTimeout(newRound, 900);
          } else {
            msg.textContent = 'Riprova üåü';
            playError();
          }
        });
      }
      newRound();
    })();

    /* ------------ SUONI ANIMALI ------------ */
    (function() {
      const q = document.getElementById('soundQuestion');
      const optsDiv = document.getElementById('soundOptions');
      const nextBtnPlay = document.getElementById('soundPlay');
      const msg = document.getElementById('soundMsg');

      const data = [
        {id:'mucca',   sound:'MUUU',    correct:'Mucca üêÆ',  options:['Mucca üêÆ','Gatto üê±','Cane üê∂','Pecora üêë']},
        {id:'cane',    sound:'BAU BAU', correct:'Cane üê∂',   options:['Mucca üêÆ','Cane üê∂','Gallina üêî','Cavallo üê¥']},
        {id:'gatto',   sound:'MIAO',   correct:'Gatto üê±',  options:['Gatto üê±','Pecora üêë','Maiale üê∑','Asino ü´è']},
        {id:'pecora',  sound:'BEEE',   correct:'Pecora üêë', options:['Cavallo üê¥','Gallo üêì','Pecora üêë','Maiale üê∑']}
      ];
      let current = null;

      function playAnimalSound(id) {
        ensureAudioContext();
        if (id === 'mucca') {
          playTone(180, 0.25, 'sawtooth', 0.3);
          setTimeout(() => playTone(180, 0.25, 'sawtooth', 0.3), 280);
        } else if (id === 'cane') {
          playTone(450, 0.1, 'square', 0.35);
          setTimeout(() => playTone(350, 0.15, 'square', 0.3), 150);
          setTimeout(() => playTone(450, 0.12, 'square', 0.3), 320);
        } else if (id === 'gatto') {
          playTone(600, 0.12, 'triangle', 0.3);
          setTimeout(() => playTone(500, 0.18, 'triangle', 0.25), 150);
        } else if (id === 'pecora') {
          playTone(280, 0.18, 'sawtooth', 0.3);
          setTimeout(() => playTone(280, 0.18, 'sawtooth', 0.3), 230);
        }
      }

      function newRound() {
        msg.textContent = '';
        current = data[Math.floor(Math.random()*data.length)];
        q.textContent = `Chi fa "${current.sound}" ?`;
        const opts = current.options.map(o => ({value:o, label:o}));
        createQuiz(optsDiv, opts, current.correct, val => {
          if (val === current.correct) {
            msg.textContent = 'Bravo! üêæ';
            playSuccess();
            setTimeout(newRound, 1100);
          } else {
            msg.textContent = 'Non √® lui, prova ancora üòä';
            playError();
          }
        });
        setTimeout(() => playAnimalSound(current.id), 300);
      }

      nextBtnPlay.addEventListener('click', () => {
        if (current) playAnimalSound(current.id);
      });

      newRound();
    })();

    /* ------------ BOLLE ------------ */
    (function() {
      const area = document.getElementById('bubbleArea');
      const btn = document.getElementById('bubbleStart');
      const scoreSpan = document.getElementById('bubbleScore');
      let score = 0;
      let interval = null;

      function spawnBubble() {
        const rect = area.getBoundingClientRect();
        const b = document.createElement('div');
        b.className = 'bubble';
        const colors = ['#49b5ff','#ff7eb3','#ffcf5b','#7ae582'];
        b.style.background = 'radial-gradient(circle at 30% 30%, #ffffff, ' +
          colors[Math.floor(Math.random()*colors.length)] + ')';
        const x = Math.random() * (rect.width - 60) + 5;
        let y = rect.height + 40;
        b.style.left = x + 'px';
        b.style.top = y + 'px';
        area.appendChild(b);
        const speed = 0.7 + Math.random()*1.1;

        const anim = setInterval(() => {
          y -= speed;
          b.style.top = y + 'px';
          if (y < -60) {
            clearInterval(anim);
            b.remove();
          }
        }, 16);

        b.addEventListener('click', () => {
          clearInterval(anim);
          b.remove();
          score++;
          scoreSpan.textContent = score;
          playSuccess();
        });
      }

      function start() {
        if (interval) return;
        score = 0;
        scoreSpan.textContent = score;
        area.innerHTML = '';
        playClick();
        interval = setInterval(spawnBubble, 450);
        setTimeout(() => {
          clearInterval(interval);
          interval = null;
        }, 30000);
      }

      btn.addEventListener('click', start);
    })();

    /* ------------ SERVICE WORKER ------------ */
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', function () {
        navigator.serviceWorker.register('service-worker.js')
          .catch(function (err) {
            console.log('SW error:', err);
          });
      });
    }
  </script>
</body>
</html>
